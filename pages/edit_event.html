{% extends 'index.html' %}
{% load static %}
{% block title %} Editar Evento - Planit{{ event.title }} {% endblock title %}
{% block header %}{% endblock header %}
{% block content %}
<!-- DIV FONDO - Div para mostrar imágen de fondo -->
<div style="min-height: 100vh; 
    background: url('{% static "blurbg.jpg" %}');
    background-size: cover;
    position: relative;
    display: flex;
    align-items: center;
    padding: 3rem 1rem;">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-lg border-0 rounded-4">
                    <div class="card-header text-white text-center p-4 rounded-top-4" style="background-color:rgb(153, 31, 0)">
                        <h3 class="mb-0">
                            <i class="bi bi-pencil-square me-2"></i>
                            Editar Evento
                        </h3>
                    </div>
                    <div class="card-body p-5">
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            
                            <div class="mb-4">
                                <label for="id_title" class="form-label fw-semibold">
                                    <i class="bi bi-card-heading me-1"></i>
                                    Título del Evento
                                </label>
                                <input 
                                    type="text" 
                                    name="title" 
                                    maxlength="100" 
                                    class="form-control form-control-lg" 
                                    id="id_title" 
                                    placeholder="Introduzca el Título del Evento"
                                    value="{{ event.title }}"
                                    required
                                >
                            </div>

                            <div class="mb-4">
                                <label for="id_description" class="form-label fw-semibold">
                                    <i class="bi bi-text-paragraph me-1"></i>
                                    Descripción
                                </label>
                                <textarea 
                                    name="description" 
                                    maxlength="1000" 
                                    class="form-control" 
                                    id="id_description" 
                                    rows="5" 
                                    placeholder="Describe tu Evento"
                                    required
                                >{{ event.description }}</textarea>
                                <div class="form-text">Máximo 1000 caracteres</div>
                            </div>

                            <div class="mb-4">
                                <label for="id_location" class="form-label fw-semibold">
                                    <i class="bi bi-geo-alt me-1"></i>
                                    Ubicación
                                </label>
                                <input 
                                    type="text" 
                                    name="location" 
                                    maxlength="200" 
                                    class="form-control" 
                                    id="id_location" 
                                    placeholder="Ubicación del Evento"
                                    value="{{ event.location }}"
                                    required
                                >
                            </div>

                            <div class="mb-4">
                                <label for="id_date_start" class="form-label fw-semibold">
                                    <i class="bi bi-calendar-event me-1"></i>
                                    Fecha y Hora
                                </label>
                                <input 
                                    type="datetime-local" 
                                    name="date_start"
                                    min="{{ now|date:'Y-m-d\\TH:i' }}"
                                    class="form-control" 
                                    id="id_date_start"
                                    value="{{ event.date_start|date:'Y-m-d\TH:i' }}"
                                    required
                                >
                            </div>

                            <div class="mb-4">
                                <label for="id_slots" class="form-label fw-semibold">
                                    <i class="bi bi-people me-1"></i>
                                    Espacios Disponibles
                                </label>
                                <input 
                                    type="number" 
                                    name="slots" 
                                    min="0" 
                                    class="form-control" 
                                    id="id_slots" 
                                    placeholder="Número de Espacios Disponibles"
                                    value="{{ event.slots }}"
                                    required
                                >
                                <div class="form-text">Asisitendo: {{ event.attendees.count }}</div>
                            </div>

                            {% if event.images.all %}
                            <div class="mb-4">
                                <label class="form-label fw-semibold">
                                    <i class="bi bi-images me-1"></i>
                                    Imágenes
                                </label>
                                <div class="row g-3">
                                    {% for image in event.images.all %}
                                    <div class="col-md-4">
                                        <div class="card position-relative">
                                            <img src="{{ image.image.url }}" class="card-img-top" alt="{{ image.caption }}" style="height: 150px; object-fit: cover;">
                                            <div class="card-body p-2">
                                                <small class="text-muted d-block mb-2">{{ image.caption|default:"No caption" }}</small>
                                                <a href="{% url 'delete_event_image' event.pk image.pk %}" 
                                                class="btn btn-danger btn-sm w-100"
                                                onclick="return confirm('Are you sure you want to delete this image?');">
                                                    <i class="bi bi-trash me-1"></i>
                                                    Eliminar
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="form-text">Haz Click en Borrar para borrar imágnes. Puedes añadir más imágenes a continuación.</div>
                            </div>
                            {% endif %}

                            <div class="mb-4">
                                <label for="id_images" class="form-label fw-semibold">
                                    <i class="bi bi-images me-1"></i>
                                    Añadir Imágenes
                                </label>
                                <input 
                                    type="file" 
                                    name="images" 
                                    class="form-control" 
                                    id="id_images" 
                                    multiple
                                    accept="image/*"
                                >
                                <div class="form-text">Puedes seleccionar múltiples imágenes (opcional)</div>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-lg text-light" style="background-color:rgb(153, 31, 0)">
                                    <i class="bi bi-check-circle me-2"></i>
                                    Actualizar Evento
                                </button>
                                <a href="{% url 'event_detail' event.pk %}" class="btn btn-outline-secondary">
                                    <i class="bi bi-x-circle me-2"></i>
                                    Cancelar
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
{% block footer %}{% endblock footer %}